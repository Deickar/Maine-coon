jQuery(function (e) { "use strict"; function r() { n.hide() } function t(r, t) { return e.ajax({ url: miniature_vars.ajaxurl, method: "get", data: { action: "miniature_search_products", product_cat: r, s: t } }) } function a(e, a) { return a.trim().length < 3 ? void r() : (l.addClass("visible"), t(e, a).done(function (e) { if (l.removeClass("visible"), e.error) { var r = h.clone(), t = e.errors.join(", "); return r.find(".category-search-results-item-thumb").remove(), r.find(".category-search-results-item-excerpt").remove(), r.find(".category-search-results-item-price").remove(), r.addClass("error").find(".category-search-results-item-title").text(t), void n.html(r).show() } var a = e.data; if (0 === a.length) { var i = h.clone(); return i.find(".category-search-results-item-thumb").remove(), i.find(".category-search-results-item-excerpt").remove(), i.find(".category-search-results-item-price").remove(), i.find(".category-search-results-item-title").text(miniature_vars.search_no_products), void n.html(i).show() } var o = a.map(function (e) { var r = h.clone(); return r.find("a").attr("href", e.url), e.image ? r.find(".category-search-results-item-thumb").html(e.image) : r.find(".category-search-results-item-thumb").remove(), r.find(".category-search-results-item-title").text(e.title), r.find(".category-search-results-item-excerpt").text(e.excerpt), r.find(".category-search-results-item-price").html(e.price), r }); n.html(o), n.show() })) } var i = (e(window), e("body")), o = e(".category-search-form"), s = e(".category-search-select"), c = e(".category-search-input"), n = e(".category-search-results"), h = e(".category-search-results-item"), l = e(".category-search-spinner"); if (window.URLSearchParams) { var u = new URLSearchParams(window.location.search), d = u.get("product_cat"), f = u.get("s"); (d || f) && (c.val(f || ""), s.val(d || "")) } var m = function (e, r, t) { var a; return function () { var i = this, o = arguments, s = function () { a = null, t || e.apply(i, o) }, c = t && !a; clearTimeout(a), a = setTimeout(s, r), c && e.apply(i, o) } }(a, 500); o.hasClass("form-ajax-enabled") && (c.on("change keyup focus", function (t) { if (!(["ArrowDown", "ArrowUp", "ArrowLeft", "ArrowRight", "Escape"].indexOf(t.key) >= 0)) { var a = e(this); if (a.val().trim().length < 3) return void r(); m(s.val(), a.val()) } }), c.on("keydown", function (e) { if ("Escape" === e.key && r(), "ArrowDown" === e.key || "ArrowUp" === e.key) { var t = n.children(), a = n.find(".highlighted"), i = a.index(); if (0 !== t.length && t) { if ("ArrowDown" === e.key) { var o = t.eq(i + 1); o.length && (t.removeClass("highlighted"), o.addClass("highlighted")), e.preventDefault() } if ("ArrowUp" === e.key) { var s = t.eq(i - 1); s.length && (t.removeClass("highlighted"), s.addClass("highlighted")), e.preventDefault() } } } }), o.on("submit", function (e) { var r = n.find(".highlighted"); r.length > 0 && (e.preventDefault(), window.location = r.find("a").attr("href")) })), i.on("click", function () { r() }).find(".category-search-input, .category-search-select").on("click", function (e) { e.stopPropagation() }) });